CREATE OR REPLACE WAREHOUSE ECOMMERCE_WH  WITH
    WAREHOUSE_SIZE = 'XSMALL'
    AUTO_SUSPEND = 60        
    AUTO_RESUME = TRUE;

CREATE OR REPLACE DATABASE ECOMMERCE_DB;

CREATE OR REPLACE SCHEMA ECOMMERCE_DB.SALES_DATA; 

USE WAREHOUSE ECOMMERCE_WH;
USE DATABASE ECOMMERCE_DB;
USE SCHEMA SALES_DATA;

CREATE OR REPLACE TABLE ORDERS (
    ORDER_ID STRING,
    CUSTOMER_ID STRING,
    ORDER_DATE DATE,
    PRODUCT_NAME STRING,
    CATEGORY STRING,
    QUANTITY INT,
    PRICE NUMBER(10,2)
);

CREATE STAGE MY_STAGE 
	DIRECTORY = ( ENABLE = true );

SELECT * FROM ORDERS;

SELECT SUM(QUANTITY * PRICE) AS TOTAL_REVENUE FROM ORDERS;


SELECT PRODUCT_NAME, SUM(QUANTITY) AS TOTAL_SOLD FROM ORDERS GROUP BY PRODUCT_NAME ORDER BY TOTAL_SOLD DESC ;

SELECT DATE_TRUNC('month', ORDER_DATE) AS MONTH, SUM(QUANTITY * PRICE) AS REVENUE FROM ORDERS GROUP BY MONTH ORDER BY MONTH;

CREATE OR REPLACE VIEW MONTHLY_REVENUE AS SELECT DATE_TRUNC('month', ORDER_DATE) AS MONTH, SUM(QUANTITY * PRICE) AS REVENUE FROM ORDERS GROUP BY MONTH;

SELECT * FROM MONTHLY_REVENUE;
